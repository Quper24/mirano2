(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();const u=(t,e)=>{let n;return(...r)=>{clearInterval(n),n=setTimeout(()=>{t(...r)},e)}},w=()=>{const t=document.querySelector(".header"),e=document.body;let n=t.offsetHeight;const r=()=>{n=t.offsetHeight},s=()=>{window.scrollY>200?(t.classList.add("header_fixed"),e.style.paddingTop=`${n}px`):(t.classList.remove("header_fixed"),e.style.paddingTop="0")};window.addEventListener("resize",u(r,100)),window.addEventListener("scroll",u(s,100))},m=(t,e=0)=>{const n=t.getBoundingClientRect(),r=window.innerWidth;n.left<0?(t.style.left="0",t.style.right="auto",t.style.transform="translateX(0)"):n.right>r?(t.style.left="auto",t.style.right="0",t.style.transform="translateX(0)"):(t.style.left="50%",t.style.right="auto",t.style.transform="translateX(-50%)");const s=t.getBoundingClientRect();(s.left<0||s.right>r)&&e<3&&(e++,m(t,e))},C=()=>{const t=document.querySelectorAll(".choices"),e=({target:n})=>{n.closest(".choices")||(t.forEach(s=>{s.querySelector(".choices__box").classList.remove("choices__box_open")}),document.removeEventListener("click",e))};t.forEach(n=>{const r=n.querySelector(".choices__btn"),s=n.querySelector(".choices__box");r.addEventListener("click",()=>{s.classList.toggle("choices__box_open"),t.forEach(c=>{c!==n&&c.querySelector(".choices__box").classList.remove("choices__box_open")}),s.classList.contains("choices__box_open")?document.addEventListener("click",e):document.removeEventListener("click",e),m(s)}),window.addEventListener("resize",u(()=>{m(s)}))})};function o(t,e={},...n){if(e=e||{},typeof t=="function")return t(e,...n);const r=document.createElement(t);return Object.entries(e).forEach(([s,c])=>{s==="class"?r.classList.add(...c.trim().split(" ")):s.startsWith("on")&&s.toLowerCase()in window?r.addEventListener(s.toLowerCase().substring(2),c):s==="style"&&typeof c=="object"?Object.assign(r.style,c):r.setAttribute(s,c)}),n.forEach(s=>{typeof s=="string"||typeof s=="number"?r.append(document.createTextNode(s.toString())):Array.isArray(s)?s.forEach(c=>r.append(c)):r.append(s)}),r}class b{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}notifyObservers(){this.observers.forEach(e=>e())}}class L extends b{constructor(){super(),this._products=[],this.categories=new Set,this._loading=!1,this.error=null}fetchProducts(){const e=this;return async n=>{try{e.error=null,e.loading=!0,e.products=await E(n),e.loading=!1,e.notifyObservers()}catch(r){console.log("error: ",r),e.error=r,e.products=[],e.loading=!1,e.notifyObservers()}}}get products(){return this._products}get loading(){return this._loading}set loading(e){this._loading=e,this.notifyObservers()}set products(e){this._products=e,this.updateCategories(e),this.notifyObservers()}getCategories(){return this.categories}updateCategories(e){this.categories.clear(),e.forEach(n=>{n.categories&&n.categories.forEach(r=>{this.categories.add(r)})}),this.notifyObservers()}}class S extends b{constructor(){super(),this.cart=[]}async init(){await this.registerCart(),await this.fetchCart()}async registerCart(){try{const e=await fetch(`${d}/api/cart/register`,{method:"POST",credentials:"include"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`)}catch(e){console.error(e)}}getCart(){return this.cart}async fetchCart(){try{const e=await fetch(`${d}/api/cart`,{method:"GET",credentials:"include"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();this.cart=n,this.notifyObservers()}catch(e){console.error(e)}}async postCart({id:e,quantity:n}){try{const r=await fetch(`${d}/api/cart/items`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e,quantity:n})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const s=await r.json();this.cart=s,this.notifyObservers()}catch(r){console.error(r)}}async addProductCart(e){await this.postCart({id:e,quantity:1})}clearCart(){this.cart=[],this.notifyObservers()}}const l=new L,a=new S,x=t=>{if(Object.keys(t).lenght===0)return"";const e=new URLSearchParams;return Object.entries(t).forEach(([n,r])=>{e.append(n,r)}),`?${e.toString()}`},d="https://dull-rose-pawpaw.glitch.me",E=async(t={})=>{try{const e=await fetch(`${d}/api/products${x(t)}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){return console.error(`Ошибка при получении данных: ${e}`),[]}},P=async t=>{try{const e=await fetch(`${d}/api/orders`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw new Error(`Ошибка при заказе, попробуйте позже! :: ${e.status}`);return await e.json()}catch(e){console.error(e)}},q=t=>o("li",{class:"cart__item"},o("img",{class:"cart__img",src:`${d}${t.photoUrl}`,alt:t.name}),o("h4",{class:"cart__item-title"},t.name),o("div",{class:"cart__counter"},o("button",{class:"cart__counter-btn",onClick:()=>{a.postCart({id:t.id,quantity:t.quantity-1})}},"-"),o("input",{class:"cart__counter-input",type:"number",max:"99",min:"0",value:t.quantity,onInput:u(({target:e})=>{console.log(),a.postCart({id:t.id,quantity:isNaN(parseInt(e.value))?t.quantity:parseInt(e.value)})},500)}),o("button",{class:"cart__counter-btn",onClick:()=>{a.postCart({id:t.id,quantity:t.quantity+1})}},"+")),o("p",{class:"cart__price"},t.price*t.quantity," ₽")),O=()=>{const t=document.querySelector(".cart__list");document.querySelector(".cart__price_total");const e=()=>{const n=a.getCart();if(t.textContent="",!n.length){const s=document.createElement("li");s.textContent="Корзина пуста",s.classList.add("cart__no-product"),t.append(s);return}const r=n.map(q);t.append(...r)};a.subscribe(e),e()},f=document.querySelector(".header__cart-button"),T=document.querySelector(".cart__close"),h=document.querySelector(".cart"),$=document.querySelector(".cart__price_total"),D=()=>{h.classList.toggle("cart_open"),h.classList.contains("cart_open")&&window.innerWidth>1360&&h.scrollIntoView({behavior:"smooth"})},I=async()=>{await a.init(),f.textContent=a.getCart().length,O(),a.subscribe(()=>{const t=a.getCart();f.textContent=t.length;const e=t.reduce((n,r)=>n+r.price*r.quantity,0);$.innerHTML=`${e}&nbsp;₽`}),f.addEventListener("click",D),T.addEventListener("click",()=>{h.classList.remove("cart_open")})},j=t=>o("li",{class:"goods__item"},o("article",{class:"goods__card card"},o("img",{class:"card__image",src:`${d}${t.photoUrl}`,alt:t.name}),o("div",{class:"card__content"},o("h3",{class:"card__title"},t.name),o("div",{class:"card__footer"},o("p",{class:"card__date-delivery"},"сегодня в 14:00"),o("button",{class:"card__button",onMouseEnter:e=>{e.target.textContent="В корзину"},onMouseLeave:e=>{e.target.innerHTML=`${t.price}&nbsp;₽`},onClick:()=>{a.addProductCart(t.id)}},t.price," ₽"))))),H=async()=>{const t=document.querySelector(".goods__list"),e=()=>{const n=l.products;if(t.innerHTML="",console.log(l.loading),n.length===0&&!l.loading){const r=document.createElement("li");r.textContent="Товары не найдены",r.classList.add("goods__no-product"),t.append(r);return}n.forEach(r=>{const s=j(r);t.append(s)})};l.subscribe(e),e()},k=t=>o("li",{class:"filter__type-item"},o("button",{class:"filter__type-button",type:"button"},t)),F=t=>o("ul",{class:"filter__type-list"},t.map(k)),M=()=>{const t=document.querySelector(".filter__choices_type"),e=document.querySelector(".filter__choices-box_type"),n=()=>{const r=l.getCategories();if(r.size){t.style.display="",e.textContent="";const s=F([...r]);e.append(s)}else t.style.display="none"};l.subscribe(n),n()},v=async function(t,e,...n){const r=document.createElement("div");r.classList.add("preload"),t.append(r),t.style.position="relative",r.style.display="flex";try{return await e(...n)}finally{r.style.display="none",r.remove(),t.style.position=""}},W=()=>{const t=document.querySelector(".filter__form"),e=document.querySelector(".goods__title"),n=document.querySelector(".goods"),r=()=>{const c=new FormData(t),i=c.get("type"),p=c.get("minPrice"),_=c.get("maxPrice"),y={};i&&(y.type=i),p&&(y.minPrice=p),_&&(y.maxPrice=_),v(n,l.fetchProducts(),y)};r();const s=u(r,500);t.addEventListener("input",c=>{const i=c.target;if(i.name==="type"){e.textContent=i.labels[0].textContent,t.minPrice.value="",t.maxPrice.value="",r();return}(i.name==="minPrice"||i.name==="maxPrice")&&s()})},N=()=>{const t=document.querySelector(".header__form"),e=document.querySelector(".goods"),n=document.querySelector(".goods__title");t.addEventListener("submit",r=>{r.preventDefault();const c=new FormData(t).get("search").trim();c&&(n.textContent="Результат поиска",v(e,l.fetchProducts(),{search:c}))})},A=()=>{document.querySelector(".order__select-wrapper").classList.add("order__select-wrapper_active")},B=()=>{document.querySelector(".order__select-wrapper").classList.remove("order__select-wrapper_active")},R=t=>{const e=new Date;e.setDate(e.getDate()+1);const n=e.getDate()<10?`0${e.getDate()}`:e.getDate(),r=e.getMonth()+1<10?`0${e.getMonth()+1}`:e.getMonth()+1,s=`${n}.${r}`;return o("div",{class:"order"},o("div",{class:"order__wrapper"},o("h2",{class:"order__title"},"Оформить заказ"),o("form",{class:"order__form",id:"order"},o("fieldset",{class:"order__fieldset"},o("legend",{class:"order__legend"},"Данные заказчика"),o("div",{class:"order__input-group"},o("input",{class:"order__input",type:"text",name:"name-buyer",placeholder:"Имя"}),o("input",{class:"order__input",type:"text",name:"phone-buyer",placeholder:"Телефон"}))),o("fieldset",{class:"order__fieldset"},o("legend",{class:"order__legend"},"Данные получателя"),o("div",{class:"order__input-group"},o("input",{class:"order__input",type:"text",name:"name-recipient",placeholder:"Имя"}),o("input",{class:"order__input",type:"text",name:"phone-recipient",placeholder:"Телефон"}))),o("fieldset",{class:"order__fieldset"},o("legend",{class:"order__legend"},"Адрес"),o("div",{class:"order__input-group"},o("input",{class:"order__input",type:"text",name:"street",placeholder:"Улица"}),o("input",{class:"order__input order__input_min",type:"text",name:"house",placeholder:"Дом"}),o("input",{class:"order__input order__input_min",type:"text",name:"apartment",placeholder:"Квартира"}))),o("fieldset",{class:"order__fieldset"},o("div",{class:"order__payment"},o("label",{class:"order__label-radio"},o("input",{class:"order__radio",type:"radio",name:"payment-online",value:"true",checked:!0}),"Оплата онлайн")),o("div",{class:"order__delivery"},o("label",{for:"delivery"},"Доставка ",s),o("input",{type:"hidden",name:"delivery-date",value:s}),o("div",{class:"order__select-wrapper"},o("select",{class:"order__select",name:"delivery-time",id:"delivery",onFocus:A,onBlur:B},o("option",{value:"9-12"},"с 9:00 до 12:00"),o("option",{value:"12-15"},"с 12:00 до 15:00"),o("option",{value:"15-18"},"с 15:00 до 18:00"),o("option",{value:"18-21"},"с 18:00 до 21:00")))))),o("div",{class:"order__footer"},o("p",{class:"order__total"},t," ₽"),o("button",{class:"order__button",type:"submit",form:"order"},"Заказать"))),o("button",{class:"order__close",type:"button"},"×"))},U=t=>o("div",{class:"order__wrapper"},o("h2",{class:"order__title"},"Заказ оформлен!"),o("p",{class:"order__id"},"Ваш номер заказа: ",t)),g=document.querySelector(".cart__order-btn"),V=document.querySelector(".cart"),z=()=>{const e=a.getCart().reduce((s,c)=>s+c.price*c.quantity,0),n=R(e);document.body.append(n),n.addEventListener("click",({target:s})=>{(s===n||s.closest(".order__close"))&&n.remove()});const r=n.querySelector(".order__form");r.addEventListener("submit",async s=>{s.preventDefault();const c=new FormData(r),i={buyer:{name:c.get("name-buyer"),phone:c.get("phone-buyer")},recipient:{name:c.get("name-recipientr"),phone:c.get("phone-recipient")},address:`${c.get("street")}, ${c.get("house")}-${c.get("apartment")}`,paymentOnline:`${c.get("payment-online")==="true"}`,deliveryDate:c.get("delivery-date"),deliveryTime:c.get("delivery-time")},p=await P(i),_=U(p.orderId);n.textContent="",n.append(_),a.clearCart(),V.classList.remove("cart_open")})},X=()=>{const t=()=>{const e=a.getCart();g.disabled=!e.length};a.subscribe(t),g.addEventListener("click",z)},J=()=>{w(),C(),M(),I(),N(),H(),W(),X()};document.addEventListener("DOMContentLoaded",J);
